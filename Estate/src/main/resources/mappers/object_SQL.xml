<?xml version="1.0" encoding= "UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 
<mapper namespace="objectDAO">
    <insert id="insertObject"  parameterType="java.util.HashMap" >
      <selectKey resultType="string" keyProperty="objtNo" order="BEFORE">
        SELECT   if ( isnull(max(objtNo)), 1, MAX(CAST(objtNo AS signed integer))+1) from saleobject       
      </selectKey>
    <![CDATA[
        INSERT into saleobject
				  ( objtNo
				  , objtTp
				  , objtNm
				  , custId
				  , buildCd
				  , buildNm
				  , businessNm
				  , area
				  , realArea
				  , saleTp
				  , bargainAmt 
				  , depositAmt 
				  , monthlyAmt 
				  , dong
				  , floor
				  , directionTp
				  , dueDt
				  , roomCnt
				  , bathCnt
				  , ondolYn 
				  , availableTp
				  , availableDt 
				  , conditionTp
				  , memo
				  , activeTp
				  , publicYn
				  , advertiseYn
				  , parcelArea
				  , rightAmt 
				  , manageAmt 
				  , interiorYn 
				  , surtaxYn
				  , parcelAmt 
				  , premiumAmt
				  , frstRegDt
				  , frstRegUser
				  , modfRegDt
				  , modfRegUser
				  , zipNo
				  , jibunAddr
				  , roadAddrPart1
				  , addrDetail
				  , positionX
				  , positionY
				  )
        	values ( 
        			#{objtNo}
        		  , #{objtTp}
				  , #{objtNm}
				  , #{custId}
				  , #{buildCd}
				  , #{buildNm}
				  , #{businessNm}
				  , CASE WHEN #{area} = '' THEN 0 ELSE #{area} END
				  , CASE WHEN #{realArea} = '' THEN 0 ELSE #{realArea} END
				  , #{saleTp} 
				  , CASE WHEN #{bargainAmt} = '' THEN 0 ELSE replace(#{bargainAmt},',','') END 
				  , CASE WHEN #{depositAmt} = '' THEN 0 ELSE replace(#{depositAmt},',','') END  
				  , CASE WHEN #{monthlyAmt} = '' THEN 0 ELSE replace(#{monthlyAmt},',','') END  
				  , #{dong}
				  , CASE WHEN #{floor} = '' THEN NULL ELSE #{floor} END 
				  , #{directionTp}
				  , CASE WHEN #{dueDt} = '' THEN NULL ELSE #{dueDt} END
				  , CASE WHEN #{roomCnt} = '' THEN NULL ELSE #{roomCnt} END 
				  , CASE WHEN #{bathCnt} = '' THEN NULL ELSE #{bathCnt} END 
				  , #{ondolYn} 
				  , #{availableTp}
				  , CASE WHEN #{availableDt} = '' THEN NULL ELSE #{availableDt} END
				  , #{conditionTp}
				  , #{memo}
				  , #{activeTp}
				  , CASE WHEN #{publicYn} = 'Y' THEN 'Y' ELSE 'N' END
				  , CASE WHEN #{advertiseYn} = 'Y' THEN 'Y' ELSE 'N' END
				  , CASE WHEN #{parcelArea} = '' THEN 0 ELSE #{parcelArea} END
				  , CASE WHEN #{rightAmt} = '' THEN 0 ELSE replace(#{rightAmt},',','') END  
				  , CASE WHEN #{manageAmt} = '' THEN 0 ELSE replace(#{manageAmt},',','') END  
				  , CASE WHEN #{interiorYn} = '' THEN NULL ELSE #{interiorYn} END 
				  , CASE WHEN #{surtaxYn} = '' THEN NULL ELSE #{surtaxYn} END 
				  , CASE WHEN #{parcelAmt} = '' THEN 0 ELSE replace(#{parcelAmt},',','') END 
				  , CASE WHEN #{premiumAmt} = '' THEN 0 ELSE replace(#{premiumAmt},',','') END 
				  , now()
				  , #{user.mbrId}
				  , now()
				  , #{user.mbrId}
				  , #{zipNo}
				  , #{jibunAddr}
				  , #{roadAddrPart1}
				  , #{addrDetail}
				  , #{positionX}
				  , #{positionY}
        	);
       ]]>
		
    </insert>
    
    <update  id="modifyObject" parameterType="java.util.HashMap" >
     UPDATE saleobject
       SET objtNm = #{objtNm}
		 , custId = #{custId}
		 , buildCd = #{buildCd}
		 , buildNm = #{buildNm}
		 , businessNm =  #{businessNm}
		 , area = (CASE WHEN #{area} = '' THEN 0 ELSE #{area} END)
		 , realArea = ( CASE WHEN #{realArea} = '' THEN 0 ELSE #{realArea} END)
		 , saleTp = #{saleTp} 
		 , bargainAmt = (CASE WHEN #{bargainAmt} = '' THEN 0 ELSE #{bargainAmt} END )
		 , depositAmt = ( CASE WHEN #{depositAmt} = '' THEN 0 ELSE #{depositAmt} END  )
		 , monthlyAmt = (CASE WHEN #{monthlyAmt} = '' THEN 0 ELSE #{monthlyAmt} END)
		 , dong =  #{dong}
		 , floor = (CASE WHEN #{floor} = '' THEN NULL ELSE #{floor} END )
		 , directionTp = #{directionTp}
		 , dueDt = (CASE WHEN #{dueDt} = '' THEN NULL ELSE #{dueDt} END) 
		 , roomCnt = ( CASE WHEN #{roomCnt} = '' THEN NULL ELSE #{roomCnt} END )
		 , bathCnt = (CASE WHEN #{bathCnt} = '' THEN NULL ELSE #{bathCnt} END )
		 , ondolYn = #{ondolYn} 
		 , availableTp = #{availableTp}
		 , availableDt = (CASE WHEN #{availableDt} = '' THEN NULL ELSE #{availableDt} END) 
		 , conditionTp =  #{conditionTp}
		 , memo =  #{memo}
		 , activeTp =  #{activeTp}
		 , publicYn = (CASE WHEN #{publicYn} = 'Y' THEN 'Y' ELSE 'N' END)
		 , advertiseYn = (CASE WHEN #{advertiseYn} = 'Y' THEN 'Y' ELSE 'N' END)
		 , parcelArea = (CASE WHEN #{parcelArea} = '' THEN 0 ELSE #{parcelArea} END)
		 , rightAmt = (CASE WHEN #{rightAmt} = '' THEN 0 ELSE #{rightAmt} END  )
		 , manageAmt = ( CASE WHEN #{manageAmt} = '' THEN 0 ELSE #{manageAmt} END  )
		 , interiorYn = (CASE WHEN #{interiorYn} = '' THEN NULL ELSE #{interiorYn} END )
		 , surtaxYn = (CASE WHEN #{surtaxYn} = '' THEN NULL ELSE #{surtaxYn} END )
		 , parcelAmt = (CASE WHEN #{parcelAmt} = '' THEN 0 ELSE #{parcelAmt} END )
		 , premiumAmt = (CASE WHEN #{premiumAmt} = '' THEN 0 ELSE #{premiumAmt} END )
		 , modfRegDt = now()
		 , modfRegUser = #{user.mbrId}
		 , zipNo = #{zipNo}
	 	 , jibunAddr = #{jibunAddr}
	  	 , roadAddrPart1 = #{roadAddrPart1}
	  	 , addrDetail = #{addrDetail}
	  	 , positionX = #{positionX}
	  	 , positionY = #{positionY}
     WHERE objtNo = #{objtNo}
       AND objtTp = #{objtTp}
    </update>
    
    <delete id="deleteObject" parameterType="java.util.HashMap" >
    DELETE FROM saleobject 
    WHERE objtNo = #{objtNo}
      AND objtTp = #{objtTp}
    </delete>
    
    <delete id="deleteInterObject" parameterType="java.util.HashMap" >
    DELETE FROM interobject 
    WHERE objtNo = #{objtNo}
    </delete>
    
    <delete id="deleteWorkDoc" parameterType="java.util.HashMap" >
    DELETE FROM workdoc 
    WHERE objtNo = #{objtNo}
    </delete>
    
    <select id="selectObjectCnt" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT A.objtTp, A.saleTp, if(isnull(cntSaleTp), 0, cntSaleTp) cntSaleTp
	FROM
		(
		SELECT a.commCd objtTp, b.commCd saleTp
		  FROM commcd a, commcd b
		 where a.groupCd = 'OT'
		   and b.groupCd = 'ST'
		) AS A
	LEFT OUTER JOIN 
	   (SELECT objtTp, saleTp, count(saleTp) cntSaleTp
		  FROM saleobject obj
		 WHERE 1=1 
		   <if test="myObjt != null and myObjt != '' ">
		   AND obj.frstRegUser = #{user.mbrId}
		   </if>
		   <if test="pageNm eq 'total'">
		   <if test="activeTp eq 'AT001'">
			AND obj.activeTp = 'AT001'
		   </if>
		   <if test="activeTp eq 'AT002'">
		   	AND obj.activeTp = 'AT002'
		   </if>
		   <if test="activeTp eq 'AT003'">
		   	AND obj.activeTp = 'AT003'
		   </if>
		   AND objtNo in ( 
					-- 1. 활성+공동인 물건은 누가 등록했든 다 보여야함
					SELECT objtNo
					  FROM saleobject objt1
					WHERE publicYn = 'Y'
					  AND activeTp = 'AT001'
	                  UNION ALL
	                -- 2. 활성만 체크된 물건은 같은부동산사람이랑 내가 등록한 물건만
	                SELECT objtNo
	                  FROM saleobject objt2
					 WHERE activeTp = 'AT001'
					   AND objt2.frstRegUser in ( <if test="user.mbrTp eq 'MT004'" >
												   SELECT mbrId
											         FROM member m1
												  </if>
												  <if test="user.mbrTp eq 'MT003' or user.mbrTp eq 'MT002'" >
												   SELECT mbrId
													 FROM member m1
													WHERE mbrTp in ('MT001','MT002', 'MT003','MT004')
													  AND estateCd = #{user.estateCd}
													</if>
					 							)
	                  UNION ALL
	                -- 3. 보류 체크된 물건은 내가 등록한 물건만 
		            SELECT objtNo
	                  FROM saleobject objt3
					 WHERE activeTp = 'AT002'
	                   AND objt3.frstRegUser = #{user.mbrId}
	                  ) 
		   </if>
		   <if test="pageNm eq 'objtPublic'">
		   AND publicYn = 'Y'
		   	<if test="activeTp eq 'AT001'">
			AND obj.activeTp = 'AT001'
		   	</if>
		   	<if test="activeTp eq 'AT002'">
		   	AND obj.activeTp = 'AT002'
		   	</if>
		   </if>
		   <if test="pageNm eq 'objtActiveY' ">
		   AND obj.activeTp = 'AT001'
		   AND obj.frstRegUser in (    <if test="user.mbrTp eq 'MT004'" >
										   SELECT mbrId
											 FROM member m1
										</if>
										<if test="user.mbrTp eq 'MT003' or user.mbrTp eq 'MT002'" >
										   SELECT mbrId
											 FROM member m1
											WHERE mbrTp in ('MT001','MT002', 'MT003','MT004')
											  AND estateCd = #{user.estateCd}
										</if>
					 				) 
		   </if>
		   <if test="pageNm eq 'objtActiveN'">
		   AND obj.activeTp = 'AT002'
		   AND obj.frstRegUser in ( 	<if test="user.mbrTp eq 'MT004'" >
										   SELECT mbrId
											 FROM member m1
										</if>
										<if test="user.mbrTp eq 'MT003' or user.mbrTp eq 'MT002'" >
										   SELECT mbrId
											 FROM member m1
											WHERE mbrTp in ('MT001','MT002', 'MT003','MT004')
											  AND estateCd = #{user.estateCd}
										</if>
					 				)
		   </if>
	  GROUP BY objtTp, saleTp
		) AS B
	 ON A.objtTp = B.objtTp
	 AND A.saleTp = B.saleTp
	ORDER BY A.objtTp, A.saleTp
    </select>
    
    <select id="selectObjectTotalCnt" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	 SELECT COUNT(*)  totalCnt
	  FROM saleobject obj
	 WHERE objtTp = #{objtTp}
	   AND saleTp = #{saleTp}	
	   <if test="myObjt != null and myObjt != '' ">
	   AND obj.frstRegUser = #{user.mbrId}
	   </if>
	   <if test="pageNm eq 'total'">
	   <if test="activeTp eq 'AT001'">
		AND obj.activeTp = 'AT001'
	   </if>
	   <if test="activeTp eq 'AT002'">
	   	AND obj.activeTp = 'AT002'
	   </if>
	   <if test="activeTp eq 'AT003'">
	   	AND obj.activeTp = 'AT003'
	   </if>
	   AND objtNo in ( 
				-- 1. 활성+공동인 물건은 누가 등록했든 다 보여야함
				SELECT objtNo
				  FROM saleobject objt1
				WHERE publicYn = 'Y'
				  AND activeTp = 'AT001'
                  UNION ALL
                -- 2. 활성만 체크된 물건은 같은부동산사람이랑 내가 등록한 물건만
                SELECT objtNo
                  FROM saleobject objt2
				 WHERE activeTp = 'AT001'
				   AND objt2.frstRegUser in ( <if test="user.mbrTp eq 'MT004'" >
											   SELECT mbrId
										         FROM member m1
											  </if>
											  <if test="user.mbrTp eq 'MT003' or user.mbrTp eq 'MT002'" >
											   SELECT mbrId
												 FROM member m1
												WHERE mbrTp in ('MT001','MT002', 'MT003','MT004')
												  AND estateCd = #{user.estateCd}
												</if>
				 							)
                  UNION ALL
                -- 3. 보류 체크된 물건은 내가 등록한 물건만 
	            SELECT objtNo
                  FROM saleobject objt3
				 WHERE activeTp = 'AT002'
                   AND objt3.frstRegUser = #{user.mbrId}
                  ) 
	   </if>
	   <if test="pageNm eq 'objtPublic'">
	   AND publicYn = 'Y'
	   	<if test="activeTp eq 'AT001'">
		AND obj.activeTp = 'AT001'
	   	</if>
	   	<if test="activeTp eq 'AT002'">
	   	AND obj.activeTp = 'AT002'
	   	</if>
	   </if>
	   <if test="pageNm eq 'objtActiveY' ">
	   AND obj.activeTp = 'AT001'
	   AND obj.frstRegUser in (    <if test="user.mbrTp eq 'MT004'" >
									   SELECT mbrId
										 FROM member m1
									</if>
									<if test="user.mbrTp eq 'MT003' or user.mbrTp eq 'MT002'" >
									   SELECT mbrId
										 FROM member m1
										WHERE mbrTp in ('MT001','MT002', 'MT003','MT004')
										  AND estateCd = #{user.estateCd}
									</if>
				 				) 
	   </if>
	   <if test="pageNm eq 'objtActiveN'">
	   AND obj.activeTp = 'AT002'
	   AND obj.frstRegUser in ( 	<if test="user.mbrTp eq 'MT004'" >
									   SELECT mbrId
										 FROM member m1
									</if>
									<if test="user.mbrTp eq 'MT003' or user.mbrTp eq 'MT002'" >
									   SELECT mbrId
										 FROM member m1
										WHERE mbrTp in ('MT001','MT002', 'MT003','MT004')
										  AND estateCd = #{user.estateCd}
									</if>
				 				)
	   </if>
	   
	</select>
	
	<select id="selectObjectList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT DATE_FORMAT(obj.frstRegDt, '%Y-%m-%d') as frstRegDt
	     , objtNo
	     , objtTp
	     , objtNm
	     , buildCd
	     , if (isnull(buildCd), buildNm, (select buildNm from building b where b.buildCd = obj.buildCd )) buildNm 
	     , CAST(area AS signed integer) area
	     , CAST(realArea AS signed integer)  realArea
	     , dong
	     , floor
	     , directionTp
	     , (select commNm from commcd where commCd = directionTp ) directionTpNm
	     , businessNm
	     , bargainAmt
	     , depositAmt
	     , monthlyAmt
	     , rightAmt
	     , manageAmt
	     , if (isnull(ondolYn), 'N', ondolYn) ondolYn
	     , conditionTp 
	     , (select commNm from commcd where commCd = conditionTp ) conditionTpNm
	     , obj.frstRegUser
	     , activeTp
	     , (select commNm from commcd where commCd = activeTp ) activeTpNm
	     , surtaxYn
	     , advertiseYn
	     , publicYn
	     , availableTp
	     , (select commNm from commcd where commCd = availableTp ) availableTpNm
	     , DATE_FORMAT(availableDt, '%Y-%m-%d') as availableDt
	 	 , parcelAmt
	 	 , premiumAmt
	     , (CASE WHEN obj.advertiseYn = 'Y' THEN '광고' END) advertiseNm
         , (CASE WHEN obj.publicYn = 'Y' THEN '공동' END) publicNm
         , (CASE WHEN obj.advertiseYn = 'Y' THEN '광고' END) advertiseNm
         , (CASE WHEN obj.publicYn = 'Y' THEN '공동' END) publicNm
         , mbrNm frstRegNm
	     , concat(e.estateNm, '(', e.tel1, '-' , e.tel2, '-', e.tel3, ')' ) estateInfo
	     , obj.zipNo
	 	 , obj.jibunAddr
	  	 , obj.roadAddrPart1 
	  	 , obj.addrDetail
	  	 , obj.positionX
	  	 , obj.positionY
	  FROM saleobject obj
		inner join member m
     		on  obj.frstRegUser = m.mbrId
	 	left outer join estate e
            on e.estateCd = m.estateCd
	 WHERE objtTp = #{objtTp}
	   AND saleTp = #{saleTp}	
	   <if test="myObjt != null and myObjt != '' ">
	   AND obj.frstRegUser = #{user.mbrId}
	   </if>
	   <if test="pageNm eq 'total'">
	   <if test="activeTp eq 'AT001'">
		AND obj.activeTp = 'AT001'
	   </if>
	   <if test="activeTp eq 'AT002'">
	   	AND obj.activeTp = 'AT002'
	   </if>
	   <if test="activeTp eq 'AT003'">
	   	AND obj.activeTp = 'AT003'
	   </if>
	   AND objtNo in ( 
				-- 1. 활성+공동인 물건은 누가 등록했든 다 보여야함
				SELECT objtNo
				  FROM saleobject objt1
				WHERE publicYn = 'Y'
				  AND activeTp = 'AT001'
                  UNION ALL
                -- 2. 활성만 체크된 물건은 같은부동산사람이랑 내가 등록한 물건만
                SELECT objtNo
                  FROM saleobject objt2
				 WHERE activeTp = 'AT001'
				   AND objt2.frstRegUser in ( <if test="user.mbrTp eq 'MT004'" >
											   SELECT mbrId
										         FROM member m1
											  </if>
											  <if test="user.mbrTp eq 'MT003' or user.mbrTp eq 'MT002'" >
											   SELECT mbrId
												 FROM member m1
												WHERE mbrTp in ('MT001','MT002', 'MT003','MT004')
												  AND estateCd = #{user.estateCd}
												</if>
				 							)
                  UNION ALL
                -- 3. 보류 체크된 물건은 내가 등록한 물건만 
	            SELECT objtNo
                  FROM saleobject objt3
				 WHERE activeTp = 'AT002'
                   AND objt3.frstRegUser = #{user.mbrId}
                  ) 
	   </if>
	   <if test="category != null and category != '' ">
	    AND buildCd = #{category}
	   </if>
	   <if test="pageNm eq 'objtPublic'">
	    AND publicYn = 'Y'
	   	<if test="activeTp eq 'AT001'">
		AND obj.activeTp = 'AT001'
	   	</if>
	   	<if test="activeTp eq 'AT002'">
	   	AND obj.activeTp = 'AT002'
	   	</if>
	   </if>
	   <if test="pageNm eq 'objtActiveY'">
	   AND obj.activeTp = 'AT001'
	   AND obj.frstRegUser in (    <if test="user.mbrTp eq 'MT004'" >
									   SELECT mbrId
										 FROM member m1
									</if>
									<if test="user.mbrTp eq 'MT003' or user.mbrTp eq 'MT002'" >
									   SELECT mbrId
										 FROM member m1
										WHERE mbrTp in ('MT001','MT002', 'MT003','MT004')
										  AND estateCd = #{user.estateCd}
									</if>
				 				)
	   </if>
	   <if test="pageNm eq 'objtActiveN'">
	   AND obj.activeTp = 'AT002'
	   AND obj.frstRegUser in ( 	<if test="user.mbrTp eq 'MT004'" >
									   SELECT mbrId
										 FROM member m1
									</if>
									<if test="user.mbrTp eq 'MT003' or user.mbrTp eq 'MT002'" >
									   SELECT mbrId
										 FROM member m1
										WHERE mbrTp in ('MT001','MT002', 'MT003','MT004')
										  AND estateCd = #{user.estateCd}
									</if>
				 				)
	   </if>
	   ORDER BY obj.frstRegDt DESC
	   LIMIT #{rowNum}, #{pagePerRow}
	</select>
	
	<select id="selectObjectInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT obj.objtNo
	     , obj.objtTp
	     , (select commNm from commcd where commCd = obj.objtTp ) objtTpNm
	     , objtNm
	     , obj.custId
	     , (select custNm from customer c where c.custId = obj.custId) custNm
	     , (select custTel1 from customer c where c.custId = obj.custId) custTel1
	     , (select custTel2 from customer c where c.custId = obj.custId) custTel2
	     , (select custTel3 from customer c where c.custId = obj.custId) custTel3
	     , businessNm
	     , obj.buildCd
	     , if (isnull(obj.buildCd), obj.buildNm, (select buildNm from building b where b.buildCd = obj.buildCd )) buildNm 
	     , saleTp
	     , (select commNm from commcd where commCd = saleTp ) saleTpNm
	     , CAST(area AS signed integer)  area
	     , CAST(realArea AS signed integer)  realArea
	     , ROUND(CAST(area AS signed integer)*3.3058,2) areaCal
	     , bargainAmt
	     , depositAmt
	     , monthlyAmt
	     , rightAmt
	     , manageAmt
	     , dong
	     , floor
	     , directionTp
	     , (select commNm from commcd where commCd = directionTp ) directionTpNm
	     , DATE_FORMAT(dueDt, '%Y-%m-%d') as dueDt
	 	 , roomCnt
	 	 , bathCnt
	     , if (isnull(ondolYn), 'N', ondolYn) ondolYn
	     , availableTp
	     , (select commNm from commcd where commCd = obj.availableTp ) availableTpNm
	     , DATE_FORMAT(availableDt, '%Y-%m-%d') as availableDt
	 	 , conditionTp 
	     , (select commNm from commcd where commCd = conditionTp ) conditionTpNm
	     , obj.activeTp
	     , (select commNm from commcd where commCd = obj.activeTp ) activeTpNm
	     , surtaxYn
	     , if ( isnull(interiorYn), '' , 'N')  interiorYn
	     , advertiseYn
	     , obj.publicYn
	     , parcelAmt
	 	 , premiumAmt
	 	 , memo
	 	 , (CASE WHEN obj.advertiseYn = 'Y' THEN '광고' END) advertiseNm
         , (CASE WHEN obj.publicYn = 'Y' THEN '공동' END) publicNm
         , DATE_FORMAT(obj.frstRegDt, '%Y-%m-%d') as frstRegDt
	     , obj.frstRegUser
	     , m.mbrNm frstRegNm
	     , (CASE WHEN #{publicYn} = 'Y' THEN (case when #{user.mbrId} = obj.frstRegUser or #{user.mbrTp} = 'MT003' or #{user.mbrTp} = 'MT004' then 'Y' else 'N' END ) ELSE 'Y' END) modifyYn
	     , concat(e.estateNm, '(', e.tel1, '-' , e.tel2, '-', e.tel3, ')' ) estateInfo
	     , e.estateNm
	     , concat(e.tel1, '-' , e.tel2, '-', e.tel3 ) estateTel
	     , if ( isnull(obj.zipNo), b.zipNo, obj.zipNo) zipno 
	 	 , if ( isnull(obj.jibunAddr), b.jibunAddr, obj.jibunAddr) jibunAddr 
	 	 , b.totalDongNum
	 	 , b.totalHouseholdNum 
	 	 , b.totalParkingNum
	 	 , b.heatingType
	 	 , b.heatingFuel
	 	 , b.builderName
	 	 , b.finishedDate
	 	 , b.minArea
	 	 , b.maxArea
	 	 , b.highestFloor
	 	 , obj.frontDoorType
	 	 , obj.sameHouseholdNum
	 	 , if ( isnull(obj.roadAddrPart1), b.roadAddrPart1 , obj.roadAddrPart1) roadAddrPart1 
	 	 , if ( isnull(obj.addrDetail), b.addrDetail, obj.addrDetail) addrDetail 
	 	 , if ( isnull(obj.positionX), b.positionX, obj.positionX) positionX 
	 	 , if ( isnull(obj.positionY), b.positionY, obj.positionY) positionY 
	 	 , (CASE WHEN #{user.estateCd} = (SELECT estateCd FROM member m WHERE m.mbrId = obj.frstRegUser ) THEN 'Y' ELSE 'N' END) workListYn
	 	 
	  FROM saleobject obj
	     left outer join building b
         on obj.buildCd = b.buildCd
		 inner join member m
         on obj.frstRegUser = m.mbrId 
	 	 left outer join estate e
         on  m.estateCd  = e.estateCd
	 WHERE obj.objtNo = #{objtNo}
	   AND obj.objtTp = #{objtTp}
	</select>

	<select id="selectTotalSearch" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	select obj.*
		,concat(b.roadAddrPart1,' ', b.addrDetail )as addr
	  from (
	SELECT DATE_FORMAT(obj.frstRegDt, '%Y-%m-%d') as frstRegDt
	     , obj.objtNo
	     , obj.objtTp
	     , (select commNm from commcd where commCd = objtTp ) objtTpNm
	     , obj.saleTP
	     , (select commNm from commcd where commCd = saleTp ) saleTpNm
	     , obj.objtNm
	     , obj.buildCd
	     , if (isnull(obj.buildCd), obj.buildNm, (select b.buildNm from building b where b.buildCd = obj.buildCd )) buildNm 
	     , obj.directionTp
	     , (select commNm from commcd where commCd = obj.directionTp ) directionTpNm
	     , obj.frstRegUser
	     , obj.activeTp
	     , (select commNm from commcd where commCd = obj.activeTp ) activeTpNm
	     , obj.surtaxYn
	     , obj.advertiseYn
	     , obj.publicYn
	     , obj.availableTp
         , m.mbrNm frstRegNm
         , custNm
         , concat(custTel1, '-',custTel2,'-',custTel3) custTel
         , concat(e.estateNm, '(', e.tel1, '-' , e.tel2, '-', e.tel3, ')' ) estateInfo
         , obj.zipNo
	 	 , obj.jibunAddr
	  	 , obj.roadAddrPart1 
	  	 , obj.addrDetail
	  	 , obj.positionX
	  	 , obj.positionY
	   FROM saleobject obj
	     left outer join customer cust
         on obj.custId = cust.custId
		 inner join member m
         on obj.frstRegUser = m.mbrId 
	 	 left outer join estate e
         on  m.estateCd  = e.estateCd
	WHERE 1=1
	   <if test="objtNm != null and objtNm != '' ">
	   and obj.objtNm like concat('%',#{objtNm},'%')
	   </if>
	   <if test="tel1 != null and tel1 != '' ">
	   and cust.custTel1 = #{tel1}
	   and cust.custTel2 = #{tel2}
	   and cust.custTel3 = #{tel3}
	   </if>
	   <if test="mbrNm != null and mbrNm != '' ">
	   and m.mbrNm like concat('%',#{mbrNm},'%')
	   </if>
	   <if test="myObjt != null and myObjt != '' ">
	   AND obj.frstRegUser = #{user.mbrId}
	   </if>
	   <if test="pageNm eq 'total'">
	   <if test="activeTp eq 'AT001'">
		AND obj.activeTp = 'AT001'
	   </if>
	   <if test="activeTp eq 'AT002'">
	   	AND obj.activeTp = 'AT002'
	   </if>
	   <if test="activeTp eq 'AT003'">
	   	AND obj.activeTp = 'AT003'
	   </if>
	   AND objtNo in ( 
				-- 1. 활성+공동인 물건은 누가 등록했든 다 보여야함
				SELECT objtNo
				  FROM saleobject objt1
				WHERE publicYn = 'Y'
			      ) 
	   </if>
	   ) obj
	   left join building b
	   on obj.buildCd = b.buildCd
	   <if test="addr != null and addr != '' ">
	    and concat(b.roadAddrPart1,' ', b.addrDetail ) like '%'||#{addr}||'%'
	   </if>
	   <if test="notPage != null and notPage != '' ">
	   LIMIT #{rowNum}, #{pagePerRow}
	   </if>
	</select>
	
	<select id="selectMainObjtList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT	DATE_FORMAT(obj.frstRegDt, '%Y-%m-%d') as frstRegDt
	     , obj.objtNo
	     , obj.objtTp
	     , (select commNm from commcd where commCd = objtTp ) objtTpNm
	     , obj.saleTP
	     , (select commNm from commcd where commCd = saleTp ) saleTpNm
	     , obj.objtNm
	     , obj.buildCd
	     , if (isnull(obj.buildCd), obj.buildNm, (select b.buildNm from building b where b.buildCd = obj.buildCd )) buildNm 
	     , obj.directionTp
	     , (select commNm from commcd where commCd = obj.directionTp ) directionTpNm
	     , obj.businessNm
	     , obj.bargainAmt
	     , obj.depositAmt
	     , obj.monthlyAmt
	     , obj.rightAmt
	     , obj.manageAmt
	     , if (isnull(obj.ondolYn), 'N', obj.ondolYn) ondolYn
	     , obj.conditionTp 
	     , (select commNm from commcd where commCd = obj.conditionTp ) conditionTpNm
	     , obj.frstRegUser
	     , obj.activeTp
	     , (select commNm from commcd where commCd = obj.activeTp ) activeTpNm
	     , obj.surtaxYn
	     , obj.advertiseYn
	     , obj.dong
	     , obj.floor
	     , CAST(obj.area AS signed integer) area
	     , ROUND(CAST(obj.area AS signed integer)*3.3058,2) areaCal
	     , CAST(obj.realArea AS signed integer) realArea
	     , obj.publicYn
	     , obj.availableTp
	     , (select commNm from commcd where commCd = obj.availableTp ) availableTpNm
	     , DATE_FORMAT(obj.availableDt, '%Y-%m-%d') as availableDt
	 	 , obj.parcelAmt
	 	 , obj.premiumAmt
         , m.mbrNm frstRegNm
         , e.estateNm
         , concat(e.tel1, '-', e.tel2,'-', e.tel3) estateTel
         , concat(e.estateNm, '(', e.tel1, '-', e.tel2,'-', e.tel3, ')') estateInfo
         , concat(custTel1, '-',custTel2,'-',custTel3) custTel
         , custNm
         , obj.zipNo
         , if (isnull(obj.jibunAddr), (select jibunAddr from building b where b.buildCd = obj.buildCd ), obj.jibunAddr ) jibunAddr
	  	 , obj.roadAddrPart1 
	  	 , obj.addrDetail
	 	 , (select totalDongNum from building b where b.buildCd = obj.buildCd ) totalDongNum
	 	 , (select totalHouseholdNum from building b where b.buildCd = obj.buildCd ) totalHouseholdNum 
	 	 , (select totalParkingNum from building b where b.buildCd = obj.buildCd ) totalParkingNum
	 	 , (select heatingType from building b where b.buildCd = obj.buildCd ) heatingType
	 	 , (select heatingFuel from building b where b.buildCd = obj.buildCd ) heatingFuel
	 	 , (select builderName from building b where b.buildCd = obj.buildCd ) builderName
	 	 , (select finishedDate from building b where b.buildCd = obj.buildCd ) finishedDate
	 	 , (select minArea from building b where b.buildCd = obj.buildCd ) minArea
	 	 , (select maxArea from building b where b.buildCd = obj.buildCd ) maxArea
	 	 , (select highestFloor from building b where b.buildCd = obj.buildCd ) highestFloor
	 	 , if ( isnull(obj.positionX), (select positionX from building b where b.buildCd = obj.buildCd ) , obj.positionX) positionX 
	 	 , if ( isnull(obj.positionY), (select positionY from building b where b.buildCd = obj.buildCd ) , obj.positionY) positionY 
	   <if test = "objtTp == 'OT001' or objtTp == 'OT004' or objtTp == 'OT005'">
	 	 , (select count(*) from saleobject where buildCd = obj.buildCd and saleTp = 'ST001' and objtTp = obj.objtTp and advertiseYn = 'Y') numOfST001
	 	 , (select count(*) from saleobject where buildCd = obj.buildCd and saleTp = 'ST002' and objtTp = obj.objtTp and advertiseYn = 'Y') numOfST002
	 	 , (select count(*) from saleobject where buildCd = obj.buildCd and saleTp = 'ST003' and objtTp = obj.objtTp and advertiseYn = 'Y') numOfST003
	 	 , (select count(*) from saleobject where buildCd = obj.buildCd and saleTp = 'ST004' and objtTp = obj.objtTp and advertiseYn = 'Y') numOfST004
	 	</if>
	 	<if test = "objtTp == 'OT002' or objtTp == 'OT003'">
	 	 , (select count(*) from saleobject where buildNm = obj.buildNm and saleTp = 'ST001' and objtTp = obj.objtTp and advertiseYn = 'Y') numOfST001
	 	 , (select count(*) from saleobject where buildNm = obj.buildNm and saleTp = 'ST005' and objtTp = obj.objtTp and advertiseYn = 'Y') numOfST005
	 	</if>
	 	<if test = "objtTp == 'OT006'">
	 	 , (select count(*) from saleobject where buildCd = obj.buildCd and saleTp = 'ST006' and objtTp = obj.objtTp and advertiseYn = 'Y') numOfST006 
	 	 , (select count(*) from saleobject where buildCd = obj.buildCd and saleTp = 'ST007' and objtTp = obj.objtTp and advertiseYn = 'Y') numOfST007 
	 	</if>
	  FROM saleobject obj
	     left outer join customer cust
         on obj.custId = cust.custId
		 inner join member m
         on obj.frstRegUser = m.mbrId 
	 	 left outer join  estate e
         on  m.estateCd  = e.estateCd
	 WHERE 1=1
	   and advertiseYn = 'Y'
	   <if test = "objtTp != null and objtTp != '' ">
	   and objtTp = #{objtTp}
	   </if>
	   <if test = "saleTp != null and saleTp != '' ">
	   and saleTp = #{saleTp}
	   </if>
	   <if test = "buildCd != null and buildCd != '' ">
	   and buildCd = #{buildCd}
	   </if>
	   
	   <if test = "(orderByColumn == 'frstRegDt' and orderByColumnDir == 'desc') or orderByColumn == '' ">
	   order by frstRegDt desc
	   </if>	
	   <if test = "orderByColumn == 'frstRegDt' and orderByColumnDir == 'asc'">
	   order by frstRegDt asc
	   </if>	   
	   <if test = "orderByColumn == 'area' and orderByColumnDir == 'desc'">
	   order by area desc
	   </if>      
	   <if test = "orderByColumn == 'area' and orderByColumnDir == 'asc'">
	   order by area asc
	   </if>   
	   <if test = "orderByColumn == 'bargainAmt' and orderByColumnDir == 'desc'">
	   order by bargainAmt desc
	   </if>   
	   <if test = "orderByColumn == 'bargainAmt' and orderByColumnDir == 'asc'">
	   order by bargainAmt asc
	   </if>    
	   <if test = "orderByColumn == 'depositAmt' and orderByColumnDir == 'desc'">
	   order by depositAmt desc
	   </if>     
	   <if test = "orderByColumn == 'depositAmt' and orderByColumnDir == 'asc'">
	   order by depositAmt asc
	   </if>  
	   <if test = "orderByColumn == 'monthlyAmt' and orderByColumnDir == 'desc'">
	   order by monthlyAmt desc
	   </if>  
	   <if test = "orderByColumn == 'monthlyAmt' and orderByColumnDir == 'asc'">
	   order by monthlyAmt asc
	   </if>   
	   <if test = "orderByColumn == 'parcelAmt' and orderByColumnDir == 'desc'">
	   order by parcelAmt desc
	   </if>     
	   <if test = "orderByColumn == 'parcelAmt' and orderByColumnDir == 'asc'">
	   order by parcelAmt asc
	   </if> 
	   
	   LIMIT #{rowNum}, #{pagePerRow}
	</select>
	
	<select id="selectMainObjectTotalCnt" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	 SELECT COUNT(*)  totalCnt
	  FROM saleobject obj
	     left outer join customer cust
         on obj.custId = cust.custId
		 inner join member m
         on obj.frstRegUser = m.mbrId 
	 	 left outer join  estate e
         on  m.estateCd  = e.estateCd
	 WHERE 1=1
	 	and objtTp = #{objtTp}
	   and saleTp = #{saleTp}	
	   and advertiseYn = 'Y'	  
	   <if test = "buildCd != null and buildCd != '' ">
	   and buildCd = #{buildCd}
	   </if>
	</select>
	
	<select id="searchMainObjtList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT	DATE_FORMAT(obj.frstRegDt, '%Y-%m-%d') as frstRegDt
	     , obj.objtNo
	     , obj.objtTp
	     , (select commNm from commcd where commCd = objtTp ) objtTpNm
	     , obj.saleTP
	     , (select commNm from commcd where commCd = saleTp ) saleTpNm
	     , obj.objtNm
	     , obj.buildCd
	     , if (isnull(obj.buildCd), obj.buildNm, (select b.buildNm from building b where b.buildCd = obj.buildCd )) buildNm 
	     , obj.directionTp
	     , (select commNm from commcd where commCd = obj.directionTp ) directionTpNm
	     , obj.businessNm
	     , obj.bargainAmt
	     , obj.depositAmt
	     , obj.monthlyAmt
	     , obj.rightAmt
	     , obj.manageAmt
	     , if (isnull(obj.ondolYn), 'N', obj.ondolYn) ondolYn
	     , obj.conditionTp 
	     , (select commNm from commcd where commCd = obj.conditionTp ) conditionTpNm
	     , obj.frstRegUser
	     , obj.activeTp
	     , (select commNm from commcd where commCd = obj.activeTp ) activeTpNm
	     , obj.surtaxYn
	     , obj.advertiseYn
	     , obj.dong
	     , obj.floor
	     , CAST(obj.area AS signed integer) area
	     , CAST(obj.realArea AS signed integer) realArea
	     , obj.publicYn
	     , obj.availableTp
	     , (select commNm from commcd where commCd = obj.availableTp ) availableTpNm
	     , DATE_FORMAT(obj.availableDt, '%Y-%m-%d') as availableDt
	 	 , obj.parcelAmt
	 	 , obj.premiumAmt
         , m.mbrNm frstRegNm
         , e.estateNm
         , concat(e.estateNm, '(', e.tel1, '-', e.tel2,'-', e.tel3, ')') estateInfo
         , custNm
         , concat(custTel1, '-',custTel2,'-',custTel3) custTel
         , obj.zipNo
         , if (isnull(obj.jibunAddr), (select jibunAddr from building b where b.buildCd = obj.buildCd ), obj.jibunAddr ) jibunAddr
	  	 , obj.roadAddrPart1 
	  	 , obj.addrDetail
	 	 , if ( isnull(obj.positionX), (select positionX from building b where b.buildCd = obj.buildCd ) , obj.positionX) positionX 
	 	 , if ( isnull(obj.positionY), (select positionY from building b where b.buildCd = obj.buildCd ) , obj.positionY) positionY 
	  FROM saleobject obj
	     left outer join customer cust
         on obj.custId = cust.custId
		 inner join member m
         on obj.frstRegUser = m.mbrId 
	 	 inner join estate e
         on  m.estateCd  = e.estateCd
	 WHERE 1=1
	   and obj.advertiseYn = 'Y'
	   <if test = "objtTp != null and objtTp != '' ">
	   and objtTp = #{objtTp}
	   </if>
	   <if test = "saleTp != null and saleTp != '' ">
	   and saleTp = #{saleTp}
	   </if>
	   
	   <if test = "bargain_min != null and bargain_min != '' and bargain_max != null and bargain_max != '' ">
	   and bargainAmt BETWEEN #{bargain_min} AND #{bargain_max}
	   </if>	   
	   <if test = "(bargain_min != null and bargain_min != '') and (bargain_max == null or bargain_max == '')">
	   and bargainAmt NOT BETWEEN 0 AND #{bargain_min}
	   </if>
	   
	   <if test = "deposit_min != null and deposit_min != '' and deposit_max != null and deposit_max != '' ">
	   and depositAmt BETWEEN #{deposit_min} AND #{deposit_max}
	   </if>	   
	   <if test = "(deposit_min != null and deposit_min != '') and (deposit_max == null or deposit_max == '')">
	   and depositAmt NOT BETWEEN 0 AND #{deposit_min}
	   </if>
	   
	   <if test = "monthly_min != null and monthly_min != '' and monthly_max != null and monthly_max != '' ">
	   and monthlyAmt BETWEEN #{monthly_min} AND #{monthly_max}
	   </if>	   
	   <if test = "(monthly_min != null and monthly_min != '') and (monthly_max == null or monthly_max == '')">
	   and monthlyAmt NOT BETWEEN 0 AND #{monthly_min}
	   </if>
	   
	   <if test = "right_min != null and right_min != '' and right_max != null and right_max != '' ">
	   and rightAmt BETWEEN #{right_min} AND #{right_max}
	   </if>	   
	   <if test = "(right_min != null and right_min != '') and (right_max == null or right_max == '')">
	   and rightAmt NOT BETWEEN 0 AND #{right_min}
	   </if>
	   
	   <if test = "manage_min != null and manage_min != '' and manage_max != null and manage_max != '' ">
	   and manageAmt BETWEEN #{manage_min} AND #{manage_max}
	   </if>	   
	   <if test = "(manage_min != null and manage_min != '') and (manage_max == null or manage_max == '')">
	   and manageAmt NOT BETWEEN 0 AND #{manage_min}
	   </if>
	   
	   <if test = "parcel_min != null and parcel_min != '' and parcel_max != null and parcel_max != '' ">
	   and parcelAmt BETWEEN #{parcel_min} AND #{parcel_max}
	   </if>	   
	   <if test = "(parcel_min != null and parcel_min != '') and (parcel_max == null or parcel_max == '')">
	   and parcelAmt NOT BETWEEN 0 AND #{parcel_min}
	   </if>
	   
	   <if test = "priminum_min != null and priminum_min != '' and priminum_max != null and priminum_max != '' ">
	   and priminumAmt BETWEEN #{priminum_min} AND #{priminum_max}
	   </if>	   
	   <if test = "(priminum_min != null and priminum_min != '') and (priminum_max == null or priminum_max == '')">
	   and bargainAmt NOT BETWEEN 0 AND #{bargain_min}
	   </if>
	   
	   <if test = "areaMin != null and areaMin != '' and areaMax != null and areaMax != '' ">
	   and area BETWEEN #{areaMin} AND #{areaMax}
	   </if>
	   order by #{orderByColumn} desc
	</select>	
	

	<select id="selectDueList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT objtNo
				 , objtTp
			     , (select commNm from commcd c where c.commCd = objtTp ) objtTpNm
			     , saleTP
			     , (select commNm from commcd c where c.commCd = saleTp ) saleTpNm
			     , objtNm
			     , buildCd
			     , publicYn
			     , activeTp
                 , DATE_FORMAT(dueDt, '%Y-%m-%d') as dueDt
                 , (TO_DAYS(now()) - TO_DAYS(dueDt)) as intvDay
			  FROM saleobject
			  WHERE 1=1
			  AND 
              (
				  (
					DATE_FORMAT(dueDt, '%Y-%m-%d')  -- 만기 3개월 1일전부터 1일후까지 list-up 
					BETWEEN DATE_FORMAT(DATE_ADD(DATE_ADD(now(),interval -3 MONTH), interval - 1 DAY), '%Y-%m-%d') 
					AND DATE_FORMAT(DATE_ADD(DATE_ADD(now(),interval -3 MONTH), interval + 3 MONTH), '%Y-%m-%d')
				  ) OR (
					DATE_FORMAT(dueDt, '%Y-%m-%d')  -- 만기 2개월 1일전부터 1일후까지 list-up 
					BETWEEN DATE_FORMAT(DATE_ADD(DATE_ADD(now(),interval -2 MONTH), interval - 1 DAY), '%Y-%m-%d') 
					AND DATE_FORMAT(DATE_ADD(DATE_ADD(now(),interval -2 MONTH), interval + 1 DAY), '%Y-%m-%d')
				  ) OR (
					DATE_FORMAT(dueDt, '%Y-%m-%d')  -- 만기 1개월 1일전부터 1일후까지 list-up
					BETWEEN DATE_FORMAT(DATE_ADD(DATE_ADD(now(),interval -1 MONTH), interval - 1 DAY), '%Y-%m-%d') 
					AND DATE_FORMAT(DATE_ADD(DATE_ADD(now(),interval -1 MONTH), interval + 1 DAY), '%Y-%m-%d')
				  ) OR (
					DATE_FORMAT(dueDt, '%Y-%m-%d')  -- 만기 1주일 남은 물건 list-up 
					BETWEEN DATE_FORMAT(DATE_ADD(now(), interval - 7 DAY), '%Y-%m-%d') 
					AND DATE_FORMAT(DATE_ADD(now(),interval -0 DAY), '%Y-%m-%d')
				  )
			  )			  
              order by dueDt desc
	</select>
		
</mapper>