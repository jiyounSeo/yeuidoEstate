<?xml version="1.0" encoding= "UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 
<mapper namespace="memberDAO">
<!--
    <resultMap type="com.test.dto.TestDTO" id="TestResultList">
        <result property="id" column="id" />
        <result property="name" column="name" />
    </resultMap>
 
    <select id="selectUsers" resultMap="TestResultList">
        SELECT id,name FROM user
    </select>
    -->
    <insert id="insertMember" parameterType="java.util.HashMap">
    	<selectKey resultType="String" keyProperty="mbrId" order="BEFORE">
	        SELECT   ifnull (MAX(CAST(mbrId AS signed integer))+1,1) from member       
	    </selectKey>
        INSERT INTO member  
        	(
        		mbrId
        	  , mbrNm
        	  , loginId
        	  , pw
        	  , mbrTp
        	  , tel1
        	  , tel2
        	  , tel3
        	  , estateCd
        	  , frstRegDt
        	  , frstRegUser
        	  , modfRegDt
        	  , modfRegUser
        	)
      SELECT  MAX(mbrId)+1
      		, #{mbrNm}
        	, #{loginId}
	       	, #{pw}
        	, 'MT001'
        	, #{tel1}
        	, #{tel2}
        	, #{tel3}
        	, #{estateCd}
        	, NOW()
        	, #{mbrId}
        	, NOW()
        	, #{mbrId}
       	FROM member
    </insert>    
    
	<select id="selectMemberList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select mbrId
			 , mbrNm
			 , loginId
			 , pw
			 , (SELECT commNm FROM commcd WHERE commCd = mbrTp) mbrTp
			 , tel1
			 , tel2
			 , tel3
			 , estateCd
			 , (SELECT estateNm FROM estate e WHERE e.estateCd = m.estateCd ) estateNm
			 , DATE_FORMAT(frstRegDt, '%Y-%m-%d') frstRegDt
			 , frstRegUser
			 , DATE_FORMAT(modfRegDt, '%Y-%m-%d') modfRedDt
			 , modfRegUser
			 , (SELECT COUNT(*) FROM member WHERE mbrTp = 'MT001') totalCnt
		  from member m
		 where 1=1
		   and mbrTp = 'MT001' 
	 LIMIT #{rowNum}, #{pagePerRow}
	 	   
	</select>
	<select id="selectOneMember" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT COUNT(*) as result
			  , mbrId
			  , loginId
			  , mbrNm
			  , mbrTp
			  , estateCd
		  FROM member m
		 WHERE 1=1
		   AND M.loginId = #{loginId}
		   <if test="pw != null and pw != '' ">
		   	AND M.pw = #{pw}
		   </if>
	</select>
	
	<select id="selectEstate" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select estateCd
		     , estateNm
		  from estate
	</select>

    <update  id="updateMemberAccept" parameterType="java.util.HashMap" >
    UPDATE member
       SET mbrTp = #{mbrTp}
     WHERE mbrId = #{mbrId}
    </update>
    
    <delete id="deleteMember" parameterType="java.util.HashMap" >
    DELETE FROM member 
     WHERE mbrId = #{mbrId}
    </delete>
    	
	
	
</mapper>